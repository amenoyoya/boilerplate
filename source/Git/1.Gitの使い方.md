# Gitの使い方

---

## 基本コマンド

### リポジトリの作成
```sh
git init
```
- カレントフォルダをGitのリポジトリ（データ倉庫）にする
- `.git`フォルダが作成される
- カレントフォルダがそのまま作業ディレクトリになる
    - `git init <フォルダ名>` で特定のフォルダをリポジトリにすることも可能

### リポジトリのクローン
```sh
git clone [リポジトリフォルダ]
```
- リポジトリフォルダ（指定しない場合はカレントフォルダ）にリポジトリと同じ名前のフォルダが作成される
- リポジトリ名のフォルダがクローンしたリポジトリ兼作業ディレクトリとなる

### Gitの設定
```sh
git config --global user.name <ユーザー名>
git config --global user.email <メールアドレス>
git config --global core.editor "<エディタ実行コマンド>"  # コミットコメント記述用のエディタを指定
git config --global core.autoCRLF <true/false>  # 改行コード自動変換を有効化/無効化
```
- `--global`を省略した場合は、現在のリポジトリでのみ有効な設定となる
- gitのglobal設定は `~\.gitconfig`ファイルに保存されている

### 設定値の確認・削除
```sh
git config <確認したい設定の名前>
git config --list  # 全設定の一覧表示

git config --unset <削除したい設定の名前>
```

### ステージングへの追加
```sh
git add <ファイル or フォルダ>
git add --all  # 変更のあったすべてのファイル・フォルダをステージングに追加
```
- リポジトリ内で変更のあったファイルやフォルダをステージングに登録する
- ステージング: リポジトリに変更を登録する前の段階で、動作の最終チェック等を行うための場
    - ステージングがあることにより、1つのコミットに含める変更内容をファイル単位で細かく制御できる

### ステージングに登録した内容を取り消す
```sh
git reset [ファイル]
```

### コミットする
```sh
git commit
```
- 現在ステージングに登録されている変更内容をリポジトリに反映する
- コミットコメントを記述するためのエディタが立ち上がる
    - `-m`オプションを付けると、一行のコミットコメントを指定しながら実行可能

### 現在の状態を確認
```sh
# コミット状態等を確認
git status

# 変更内容の差分を確認
git diff [ファイル]
```

### コミットログの確認
```sh
git log
git log -n <表示件数>  # 表示件数を指定
git log --oneline  # 1コミット1行で表示
git log --grep="<検索パターン>"  # コミットコメントで検索
git log <ファイル>  # 特定のファイルのコミットログだけ確認
git log --graph  # グラフ形式で表示
```

### ファイル削除
```sh
git rm <削除するファイル>
```
- リポジトリの管理からファイルを削除する
- 作業ディレクトリからも物理的にファイルが削除される

### 特定のリビジョンに戻る
```sh
git checkout <コミットハッシュ> [ファイル]
```
- 作業状態を指定したコミットハッシュの時点に戻す
- ファイルを指定した場合は、指定したファイルのみ特定のリビジョンに戻せる
- コミットハッシュは `git log` で確認

### 過去のコミットを打ち消す
```sh
git revert <コミットハッシュ>
```
- 過去のコミットを削除するのではなく、打ち消す形で新規にコミットを行う
- コミットコメントを記述するためのエディタが立ち上がる
    - `-m`オプションを付けると、一行のコミットコメントを指定しながら実行可能
- `-n`オプションを付けると、自動コミットせず、あとから手動でコミットすることになる
- `--abort`オプションを付けると、コミットされていないrevertを取り消すことができる

### 現在の変更内容を取り消す
```sh
# ファイルを指定
git checkout HEAD <ファイル>

# 全ファイル一括で取り消す
git reset --hard

# ※上記コマンドは、リモートリポジトリにpushする前の段階で使うべきコマンド
# リモートリポジトリにpushしてしまった後は、revertで過去のコミットを打ち消すしかない
```

### リポジトリに登録されていないファイルを削除
```sh
# 削除されるファイルを確認
git clean -n

# 登録されていないファイルを全削除
git clean -f
```

### ブランチの作成
```sh
git branch <ブランチ名>
```
- ブランチ: 複数人で並行して作業する際に、履歴の流れを分岐して記録するための仕組み
    - 履歴の本流は`master`ブランチ
    - 分岐したブランチは他のブランチとマージすることで一つのブランチにまとめ直すことが可能

### 存在するブランチの確認
```sh
$ git branch
* master
  develop
```
- `-v`オプションを付けると、ブランチのハッシュやコミットコメントも確認可能
- `-a`オプションをつけると、リモートブランチも確認可能

### ブランチのマージ
```sh
git merge <マージするブランチ名>
```
- 現在作業しているブランチに対象のブランチをマージする
- 競合が発生した場合は、強豪を解決してから `add` -> `commit` する

### ブランチの削除
```sh
git branch -d <ブランチ名>
```
- マージしていないコミットがある場合はエラーになるため、`merge`してから削除すること

### ブランチの切り替え
```sh
# 対象のブランチのHEAD(最新状態)に切り替え
git checkout <ブランチ名>

# 新規ブランチを作成して切り替え
git checkout -b <ブランチ名>

# 新規ブランチをリモートブランチと同期して切り替え
git checkout -b <ブランチ名> <リポジトリ名>/<ブランチ名>
```
- 
- `-b`オプションを付けると、ブランチを新規作成しながら切替可能

### タグの作成
```sh
git tag <タグ名>  # 名前だけのタグ(軽量タグ)を作成
git tag -a <タグ名> -m "<コメント>"  # コメント付きのタグ(注釈付きタグ)を作成
```

### タグの確認
```sh
git tag
git show <タグ名>  # 指定タグの詳細表示
```

### タグの削除
```sh
git tag -d <タグ名>
```

### クローン元のリポジトリから最新のコードを取得
```sh
git pull
```

### クローン元のリポジトリにローカルリポジトリを反映
```sh
git push
```

### リモートリポジトリをローカルリポジトリに追加
```sh
git remote add <リポジトリ名> <リモートリポジトリURL>
```
- GitHubやGitLab等のWeb上のリポジトリを登録可能
- 通常リモートリポジトリは1つしか使わないため、リポジトリ名は慣例的に`origin`を使うことが多い

### リモートリポジトリをローカルリポジトリから削除
```sh
git remote remove <リポジトリ名>
```

### ローカルリポジトリに登録されているリモートリポジトリを確認
```sh
git remote  # -v オプションを付けると詳細を確認できる
```

### リモートリポジトリから最新のコードを取得
```sh
git pull <リポジトリ名> <ブランチ名>
```

### ローカルリポジトリの内容をリモートリポジトリに反映
```sh
# リモートリポジトリに存在しないブランチを指定した場合は、新規作成する
git push -u <リポジトリ名> <ブランチ名>

# リモートリポジトリのブランチを削除する
git push --delete <リポジトリ名> <削除するブランチ名>
```

---

## .gitignore
.gitignore
: gitに追加したくないファイルを指定する設定ファイル

### 基本
- .gitignoreを使うと無視する（Gitのトラッキングの対象外とする）ファイル or ディレクトリを指定できる
- .gitignoreは複数のディレクトリに置くことができる
    - 深い階層の.gitignoreに書かれた指定の方が優先順位が高い（後に解釈される）
- .gitignore内の記述は上の行から順に以下のように解釈される
    - `/`を含まない行（`file`など）
        - .gitignore以下の**全サブディレクトリ下**にあるこの名前の**ファイル or ディレクトリ**を無視する
    - 末尾以外にのみ`/`を含む行（`/file`, `/path/to/file`, `path/to/file`など）
        - .gitignoreが置いてあるディレクトリをカレントディレクトリとする**相対パス**で指定される**ファイル or ディレクトリ**を無視する
    - 末尾だけ`/`な行（`directory/`など）
        - .gitignore以下の**全サブディレクトリ下**にあるこの名前の**ディレクトリ**を無視する
    - 末尾以外にも末尾にも`/`を含む行（`/directory/`, `/path/to/directory/`, `path/to/directory/`など）
        - .gitignoreが置いてあるディレクトリをカレントディレクトリとする**相対パス**で指定される**ディレクトリ**を無視する
    - `!`で始まる行（`!/path/to/file`など）
        - `!`以降のパターン文字列が示すファイル or ディレクトリを**無視しない**
        - 前の無視指定を上書きする
        - 以降の無視指定に上書きされうる
    - 空行 or `#`で始まる行
        - 解釈されない

以下のようなディレクトリ構成の場合、.gitignoreに`file`とだけ書くと、file も directory/file も共に無視されることに注意！
```
|- .git/
|- .gitignore
|- file
|- directory/
   |- file
```
.gitignoreと同ディレクトリにある file のみを無視したい場合は、`/file`と書く必要がある。

なお、Gitリポジトリのルート、あるいはOSのルートからの絶対パス指定をする方法はない

.gitignoreはそこから下のディレクトリにしか影響を及ぼせない

### ワイルドカード
.out という拡張子のファイルをまとめて無視したい場合`*.out`のように記述できる

このようなワイルドカードの類には以下のようなものがある

- `*`
    - `/`以外の0文字以上の文字列にマッチ
    - シェルのパス名展開で使われる`*`と同じ意味
- `?`
    - `/`以外の1文字にマッチ
    - シェルのパス名展開で使われる`?`と同じ意味
- `[0-9]`など
    - `/`以外の指定した1文字にマッチ
    - シェルのパス名展開で使われる`[0-9]`などと同じ意味
- `**`
    - 0個以上の**ファイル or ディレクトリ**にマッチ
    - 例えば`/a/**`は`/a`, `/a/x`, `/a/x/y`などにマッチし、`/**/b`は`/b`, `/x/b`, `/x/y/b`などにマッチし、`/a/**/b`は`/a/b`, `/a/x/b`, `/a/x/y/b`などにマッチする
